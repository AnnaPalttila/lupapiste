<!DOCTYPE html>
<html>
  <body>
    <section class="page" id="stamp-dialog" style="visibility: visible; display: block;">
      <script type="text/html" id="dialog-stamp-attachments">
        <div>
          <div class="stamp-margin">
            <table>
              <tbody>
                <tr>
                  <td data-bind="ltext: 'stamp.information'" colspan="3"></td>
                </tr>
                <tr>
                  <td data-bind="ltext: 'stamp.text'" class="label"></td>
                  <td colspan="2">
                    <input
                      data-bind="value: text, enable: status() === statusReady"
                      type="text"
                      class="form-input text"/>
                    </td>
                </tr>
                <tr>
                  <td data-bind="ltext: 'stamp.date'" class="label"></td>
                  <td colspan="2">
                    <input
                      data-bind="
                        datepicker: date,
                        enable: status() === statusReady,
                        valueUpdate: 'afterkeydown'"
                      type="text"
                      class="form-input text"/>
                    </td>
                </tr>
                <tr>
                  <td data-bind="ltext: 'stamp.organization'" class="label"></td>
                  <td colspan="2">
                    <input
                      data-bind="textInput: organization, enable: status() === statusReady"
                      type="text"
                      class="form-input text"/>
                    </td>
                </tr>
                <tr>
                  <td data-bind="ltext: 'stamp.margin'" colspan="3"></td>
                </tr>
                <tr>
                  <td data-bind="ltext: 'stamp.xMargin'" class="label"></td>
                  <td>
                    <input
                      data-bind="
                        textInput: xMargin,
                        enable: status() === statusReady,
                        css: {'invalid-margin': !xMarginOk()}"
                      type="text"
                      class="form-input text"/>
                    </td>
                  <td>mm</td>
                </tr>
                <tr>
                  <td data-bind="ltext: 'stamp.yMargin'" class="label"></td>
                  <td>
                    <input
                      data-bind="
                        textInput: yMargin,
                        enable: status() === statusReady,
                        css: {'invalid-margin': !yMarginOk()}"
                      type="text"
                      class="form-input text"/>
                    </td>
                  <td>mm</td>
                </tr>
                <tr>
                  <td data-bind="ltext: 'stamp.transparency'" class="label"></td>
                  <td colspan="2">
                    <select data-bind="options: transparencies, optionsText: 'text', value: transparency" class="form-input combobox"></select>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <table class="table attachments-template-table">
            <tbody data-bind="foreach: files()">
              <tr class="attachment-group-header">
                <td data-bind="text: name" colspan="6" data-test-id="attachment-group-header-text"></td>
                <td class="attachment-group-select"><a href="#" data-bind="ltext: 'attachments.group.select', click: $parent.toggleGroupSelect, visible: $parent.status() < $parent.statusRunning"></a></td>
              </tr>
              <tr>
                <th data-bind="ltext: 'application.attachmentState'">Tila</th>
                <th colspan="2" data-bind="ltext: 'application.attachmentType'">Tyyppi</th>
                <th data-bind="ltext: 'application.attachmentFile'">Tiedosto</th>
                <th data-bind="ltext: 'application.attachmentVersion'">Versio</th>
                <th data-bind="ltext: 'application.attachmentEditDate'">Muokattu</th>
                <th></th>
              </tr>

              <!-- ko foreach: attachments -->
              <tr class="attachment-row">
                <td class="attachmentState">

                  <span data-bind="attr: {'class': statusName + ' icon',
                                  'data-test-state': state,
                                  'data-test-type': type['type-group'] + '.' + type['type-id'],
                                  'title': loc(statusName + '.title')}">
                  </span>
                  <span data-bind="visible:$data.signed,
                                   attr: {'class': 'icon signed',
                                   'title': loc('attachment.signed'),
                                   'data-test-icon': 'signed-' + type['type-group'] + '.' + type['type-id']}">
                  </span>
                  <span data-bind="visible:$data.isSent,
                                   attr: {'class': 'icon transfered',
                                   'title': loc('application.attachmentSentDate') + ' ' + $data.sentDateString,
                                   'data-test-icon': 'transfered-' + type['type-group'] + '.' + type['type-id']}">
                  </span>
                  <span data-bind="visible:$data.stamped,
                                   attr: {'class': 'icon stamped',
                                   'title': loc('attachment.stamped'),
                                   'data-test-icon': 'stamped-' + type['type-group'] + '.' + type['type-id']}">
                  </span>
                </td>
                <td class="attachment-type-group">
                    <span data-bind="if: type">
                      <span data-bind="text: loc(['attachmentType', type['type-group'], '_group_label'])"></span>
                    </span>
                    <span data-bind="if: !type">
                      <i data-bind="ltext: 'attachment.noName'"></i>
                    </span>
                </td>
                <td class="attachment-type-id">
                  <a data-bind="attr: {href: '#!/attachment/' + $root.application.id() + '/' + id, 'data-test-type': type['type-group'] + '.' + type['type-id']}">
                    <span data-bind="if: type">
                      <span data-bind="text: loc(['attachmentType', type['type-group'], type['type-id']])"></span>
                    </span>
                    <span data-bind="if: !type">
                      <i data-bind="ltext: 'attachment.noName'"></i>
                    </span>
                  </a>
                  <!-- ko if: $data.contents -->
                    <div class="attachment-content-desc"><span data-bind="text: $data.contents" data-test-id="attachment-contents"></span></div>
                  <!-- /ko -->
                </td>
                <td>
                  <span data-bind="if: $data.latestVersion">
                    <a href="#" data-bind="text: latestVersion.filename,
                                           attr: {href: '/api/raw/download-attachment?attachment-id=' + latestVersion.fileId,
                                                  title: loc('download')},
                                           click: function() {return true;},
                                           clickBubble: false"></a><br/>
                    <i data-bind="ltext: latestVersion.contentType"></i>
                    <i data-bind="size: latestVersion.size"></i>
                  </span>
                  <!-- ko ifnot: $data.latestVersion -->
                  <a data-bind="ltext: 'application.attachmentsAddList', attr: {href: '#!/attachment/' + $root.application.id() + '/' + id, 'data-test-type': type['type-group'] + '.' + type['type-id']}"></a>
                  <!-- /ko -->
                </td>
                <td>
                  <span data-bind="if: $data.latestVersion">
                    <span data-bind="version: latestVersion.version"></span>
                  </span>
                </td>
                <td>
                  <span data-bind="if: $data.latestVersion">
                    <span data-bind="dateString: modified"></span>
                    <span data-bind="fullName: latestVersion.user"></span>
                  </span>
                </td>
                <td>
                  <input type="checkbox" data-bind="checked: $data.selected,
                        visible: $parents[1].status() < $parents[1].statusRunning,
                        enable: $parents[1].status() === $parents[1].statusReady" />
                    <span data-bind="
                        text: loc(['stamp.file.status', $data.status()]),
                        visible: $parents[1].status() >= $parents[1].statusRunning"></span>
                </td>
              </tr>

              <!-- /ko -->
            </tbody>
          </table>

          <div class="stamp-status">
            <span data-bind="text: loc(['stamp.status', status().toString()])"></span>
          </div>

          <div class="stamp-buttons">
            <button data-bind="
                click: start,
                ltext: 'stamp.start',
                enable: status() === statusReady && xMarginOk() && yMarginOk() && selectedFiles().length > 0,
                visible: status() <= statusReady"
              class="btn btn-primary"
              data-test-id="start-stamping">
            </button>
            <button data-bind="
                ltext: 'stamp.cancel',
                enable: status() === statusReady,
                visible: status() <= statusReady,
                click: $parent.cancelStamping"
              class="btn close">
            </button>
            <button data-bind="
                ltext: 'stamp.ok',
                visible: status() > statusRunning,
                click: $parent.cancelStamping"
              class="btn btn-primary close"
              data-test-id="application-stamp-dialdog-ok">
            </button>
          </div>
        </div>
      </script>
    </section>
  </body>
</html>