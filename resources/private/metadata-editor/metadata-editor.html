<!DOCTYPE html>
<html>
<body>
<section class="page container" id="stamping">
  <script type="text/html" id="metadata-editor-template">
    <div class="metadata-editor-container">
      <div class="editor">
        <div class="editor-header">
          <div data-bind="ltext: 'attachment.tosMetadata'"></div>
          <div class="edit-button-container">
            <div class="edit-button" data-bind="click: edit, if: displayOnly">
              <i class="lupicon-pen edit"></i>
            </div>
            <div class="edit-button" data-bind="click: cancelEdit, if: editable">
              <i class="lupicon-circle-remove edit"></i>
            </div>
          </div>
        </div>
        <div class="editor-form">
          <div data-bind="foreach: schema">
            <div data-bind="if: $data.values">
              <label data-bind="ltext: type"></label><br>
              <div data-bind="visible: $parent.displayOnly,
                              ltext: $parent.editedMetadata()[type]"></div>
              <select data-bind="visible: $parent.editable,
                                   options: values,
                                   optionsText: loc,
                                   value: $parent.editedMetadata()[type]" ></select>
            </div>
            <div data-bind="if: $data.inputType">
              <label data-bind="ltext: type"></label><br>
              <div data-bind="visible: $parent.displayOnly,
                              text: $parent.editedMetadata()[type]"></div>
              <input class="form-input" data-bind="visible: $parent.editable,
                                                   attr: {type: inputType},
                                                   textInput: $parent.editedMetadata()[type],
                                                   css: {invalid: $parent.invalidFields().indexOf(type) >= 0}">
            </div>
            <div data-bind="if: $data.subfields">
              <div class="subtable">
                <h4 data-bind="ltext: type"></h4>
                <div data-bind="foreach: subfields">
                  <label data-bind="ltext: type"></label><br>
                  <div data-bind="if: $data.values">
                    <div data-bind="visible: $parents[1].displayOnly,
                                    ltext: $parents[1].editedMetadata()[$parent.type][type]"></div>
                    <select data-bind="visible: $parents[1].editable,
                                       options: values,
                                       optionsText: loc,
                                       value: $parents[1].editedMetadata()[$parent.type][type]"></select>
                  </div>
                  <div data-bind="if: $data.inputType">
                    <div data-bind="visible: $parents[1].displayOnly,
                                    text: $parents[1].editedMetadata()[$parent.type][type]"></div>
                    <div data-bind="visible: $parents[1].editable">
                      <input class="form-input" data-bind="textInput: $parents[1].editedMetadata()[$parent.type][type], attr: {type: inputType},
                                                           css: {invalid: $parents[1].invalidFields().indexOf(type) >= 0}">
                    </div>
                  </div>

                  <div data-bind="if: $data.dependencies && $data.dependencies[$parents[1].editedMetadata()[$parent.type][type]()]">
                    <div data-bind="foreach: $data.dependencies[$parents[1].editedMetadata()[$parent.type][type]()]">
                      <label data-bind="ltext: type"></label><br>
                      <div data-bind="if: $data.values">
                        <div data-bind="visible: $parents[2].displayOnly,
                                  ltext: $parents[2].editedMetadata()[$parents[1].type][type]"></div>
                        <select data-bind="visible: $parents[2].editable,
                                     options: values,
                                     optionsText: loc,
                                     value: $parents[2].editedMetadata()[$parents[1].type][type]"></select>
                      </div>
                      <div data-bind="if: $data.inputType">
                        <div data-bind="visible: $parents[2].displayOnly,
                                  text: $parents[2].editedMetadata()[$parents[1].type][type]"></div>
                        <div data-bind="visible: $parents[2].editable">
                          <input class="form-input" data-bind="textInput: $parents[2].editedMetadata()[$parents[1].type][type], attr: {type: inputType},
                                                               css: {invalid: $parents[2].invalidFields().indexOf(type) >= 0}">
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
            <div data-bind="if: $data.dependencies && $data.dependencies[$parent.editedMetadata()[type]()]">
              <div data-bind="foreach: $data.dependencies[$parent.editedMetadata()[type]()]">
                <label data-bind="ltext: type"></label><br>
                <div data-bind="if: $data.values">
                  <div data-bind="visible: $parents[1].displayOnly,
                                  ltext: $parents[1].editedMetadata()[type]"></div>
                  <select data-bind="visible: $parents[1].editable,
                                     options: values,
                                     optionsText: loc,
                                     value: $parents[1].editedMetadata()[type]"></select>
                </div>
                <div data-bind="if: $data.inputType">
                  <div data-bind="visible: $parents[1].displayOnly,
                                  text: $parents[1].editedMetadata()[type]"></div>
                  <div data-bind="visible: $parents[1].editable">
                    <input class="form-input" data-bind="textInput: $parents[1].editedMetadata()[type], attr: {type: inputType},
                                                         css: {invalid: $parents[1].invalidFields().indexOf(type) >= 0}">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div data-bind="if: editable" class="editor-buttons">
            <button class="btn-primary save" data-bind="click: save, ltext: 'save', enable: invalidFields().length === 0"></button>
          </div>
        </div>
      </div>


    </div>
 </script>
</section>
</body>
</html>