<!DOCTYPE html>
<html>
<body>
<section class="page container" id="stamping">
  <script type="text/html" id="metadata-editor-template">
    <div class="metadata-editor-container">
      <div class="editor">
        <div class="editor-header">
          <div data-bind="ltext: 'attachment.tosMetadata'"></div>
          <div class="edit-button-container">
            <div class="edit-button" data-bind="click: edit, if: displayOnly">
              <i class="lupicon-pen edit"></i>
            </div>
            <div class="edit-button" data-bind="click: cancelEdit, if: editable">
              <i class="lupicon-circle-remove edit"></i>
            </div>
          </div>
        </div>
        <div class="editor-form">

          <div data-bind="template: {name: 'metadata-list-template', data: {schemaList: schema, values: editedMetadata(), invalidFields: invalidFields(), editable: editable}}"></div>

          <div data-bind="if: editable" class="editor-buttons">
            <button class="btn-primary save" data-bind="click: save, ltext: 'save', enable: invalidFields().length === 0"></button>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/html" id="metadata-list-template">
    <div data-bind="foreach: schemaList">
      <div data-bind="if: $data.values">
        <label data-bind="ltext: type"></label><br>
        <div data-bind="visible: !$parent.editable(),
                        ltext: $parent.values[type]"></div>
        <select data-bind="visible: $parent.editable,
                                   options: values,
                                   optionsText: loc,
                                   value: $parent.values[type]" ></select>
      </div>
      <div data-bind="if: $data.inputType" class="text-input-container">
        <label data-bind="ltext: type"></label><br>
        <div data-bind="visible: !$parent.editable(),
                        text: $parent.values[type]"></div
        ><div data-bind="visible: $parent.editable">
        <input class="form-input" data-bind="attr: {type: inputType},
                                             textInput: $parent.values[type],
                                             css: {invalid: $parent.invalidFields.indexOf(type) >= 0}">
      </div
      ><div data-bind="if: inputType === 'number'" class="year-label"><span data-bind="ltext: 'vuotta'"></span></div>
      </div>
      <div data-bind="if: $data.subfields">
        <div class="subtable">
          <h4 data-bind="ltext: type"></h4>
          <div data-bind="template: {name: 'metadata-list-template', data: {schemaList: subfields, values: $parent.values[type], invalidFields: $parent.invalidFields, editable: $parent.editable}}"></div>
        </div>
      </div>
      <div data-bind="if: $data.dependencies && $data.dependencies[$parent.values[type]()]">
        <div data-bind="template: {name: 'metadata-list-template', data: {schemaList: $data.dependencies[$parent.values[type]()], values: $parent.values, invalidFields: $parent.invalidFields, editable: $parent.editable}}"></div>
      </div>
    </div>
  </script>
</section>
</body>
</html>