<!DOCTYPE html>
<html>
<body>
  <section class="page container" id="statement" data-bind="with: $root.statementModel">
    <div>
      <div class="attachment-info">
        <h1>
          <span data-bind="with: application">
            <span data-bind="text: title"></span>:
          </span>
          <span data-bind="with: data">
            <span data-bind="text: person.text"></span>
          </span>
        </h1>
        <span data-bind="with: application">
          <a class="btn attachment-back" data-bind="attr: {href: '#!/application/' + id() + '/statement' }, ltext: 'attachment.return'"></a>
        </span>
        <div class="form-entry">
          <button data-bind="ltext: 'statement.delete', click: $root.statementModel.openDeleteDialog, visible: $root.authorization.ok('delete-statement'), enable: $root.authorization.ok('delete-statement')" style="margin-left: 0" data-test-id="delete-statement">Poista lausunto</button>
          <br/><br/>
          <label for="attachment-type-select" class="form-label">
           <span data-bind="ltext: 'statement.title'">Puoltotieto</span>
           <img src="/img/ajax-loader-12.gif" alt="..." id="attachment-type-select-loader" style="display: none;">
          </label>
          <form data-bind="with: $root.statementModel">
            <select id="statement-type-select" data-bind="options: statuses, optionsText: function(item) { return loc('statement.'+item);}, value: selectedStatus, optionsCaption: loc('choose'), disable: !$root.authorization.ok('give-statement')"></select>
            <textarea
              data-bind="attr: {placeholder: loc('comment.placeholder')}, value: text, valueUpdate: 'afterkeydown', disable: !$root.authorization.ok('give-statement')"
              id="attachment.commentText"
              class="conversation-input"
              rows="10"></textarea>
            <button
                data-bind="disable: disabled, click: submit, ltext: 'statement.submit', visible: $root.authorization.ok('give-statement')"
                id="attachment.addComment"
                type="submit"
                class="btn btn-primary">
              Jätä lausunto
            </button>
          </form>
      </div>

      <div data-bind="with: $root.attachmentsModel">
        <h3 class="tab-info" data-bind="ltext: 'inforequest.attachments'"></h3>
        <div data-bind="if: attachments().length">
          <table class="table" data-test-id="inforequest-attachments-table">
            <tbody>
              <tr>
                <th data-bind="ltext: 'application.attachmentFile'">Tiedosto</th>
                <th data-bind="ltext: 'application.attachmentEditDate'">Muokattu</th>
                <th></th>
              </tr>
              <!-- ko foreach: attachments -->
              <!-- ko if: latestVersion && latestVersion.filename -->
              <tr>
                <td>
                    <a href="#" data-bind="text: latestVersion.filename, attr: {href: '/api/download-attachment/' + latestVersion.fileId}"></a><br/>
                    <i data-bind="ltext: latestVersion.contentType"></i>
                    <i data-bind="size: latestVersion.size"></i>
                </td>
                <td>
                  <span data-bind="dateString: modified"></span>
                  <span data-bind="if: $data.latestVersion">
                    <span data-bind="fullName: latestVersion.user"></span>
                  </span>
                </td>
                <td>
                </td>
              </tr>
              <!-- /ko -->
              <!-- /ko -->
            </tbody>
          </table>
        </div>

        <div data-bind="ifnot: attachments().length">
          <i data-bind="ltext: 'inforequest.attachmentsEmpty'" data-test-id="inforequest-attachments-no-attachments"></i>
        </div>

        <button
          class="btn modal"
          data-bind="ltext: 'application.attachmentsAdd', visible: $root.authorization.ok('upload-attachment'), enabled: $root.authorization.ok('upload-attachment'), click: newAttachment"
          data-test-id="add-inforequest-attachment"
          data-window-id="upload-dialog"></button>
      </div>


      <div class="attachment-file-conversation" data-bind="with: $root.commentsModel">
        <h3 data-bind="ltext: 'statement.conversation'">Keskustele päätöksestä:</h3>
        <table class="table table-striped">
          <tbody data-bind="foreach: comments">
            <tr class="comment">
              <td class="commentParty">
                <span class="date" data-bind="dateTimeString: created"></span><br/>
                <span class="author" data-bind="text: user.firstName()+' '+user.lastName()"></span><br/>
                <b>(<span class="role" data-bind="ltext: user.role"></span>)</b>
              </td>
              <td class="comment-text">
                <span data-bind="text: text"></span>
              </td>
            </tr>
          </tbody>
        </table>
        <form>
          <textarea
            data-bind="attr: {placeholder: loc('comment.placeholder')}, value: text, valueUpdate: 'afterkeydown'"
            id="statement.commentText"
            class="conversation-input"
            rows="3">
          </textarea>
          <button
              data-bind="disable: disabled, click: submit, ltext: 'attachment.send', visible: $root.authorization.ok('add-comment')"
              id="attachment.addComment"
              type="submit"
              class="btn btn-primary">
            Lähetä viesti
          </button>
        </form>
      </div>
    </div>

  </section>
</body>
</html>
