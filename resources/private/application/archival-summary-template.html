<!DOCTYPE html>
<html>
<body>
<section class="page" id="archival-summary" style="visibility: hidden; display: block;">
  <script type="text/html" id="archival-summary-template">

    <div data-bind="if: showArchived" class="archival-summary-document-set">
      <h1>Arkistoitavat asiakirjat - <span data-bind="text: $root.application.id"></span></h1>
      <div>
      Asiakirjan säilytysaika määrää arkistoidaanko asiakirjaa. Voit muokata asiakirjan arkistointiaikaa ja
      muita tietoja klikkaamalla asiakirjan riviä.
      </div>

      <div data-bind="if: !_.isEmpty(archivedDocuments())">
        <div data-bind="template: {name: 'archival-summary-document-table', data: {documents: archivedDocuments, showWillPublish: true}}"></div>
      </div>

      <div data-bind="template: {name: 'archival-summary-attachment-table', data: {groups: archivedGroups, showWillPublish: true, attachmentTypes: selectableAttachmentTypes}}"></div>

      <div><button class="btn-primary">Vie arkistoon</button></div>
    </div>

    <div data-bind="if: showNotArchived" class="document-set">
      <h1>Muut asiakirjat (ei arkistoida) - <span data-bind="text: $root.application.id"></span></h1>

      <div data-bind="if: !_.isEmpty(notArchivedDocuments())">
        <div data-bind="template: {name: 'archival-summary-document-table', data: {documents: notArchivedDocuments, showWillPublish: false}}"></div>
      </div>

      <div data-bind="template: {name: 'archival-summary-attachment-table', data: {groups: notArchivedGroups, showWillPublish: false, attachmentTypes: selectableAttachmentTypes}}"></div>
    </div>

  </script>
  <script type="text/html" id="archival-summary-attachment-table">
    <table class="table archival-summary-table">
      <tbody data-bind="foreach: groups">
      <tr class="attachment-group-header">
        <td data-bind="text: name" colspan="5"></td>
      </tr>

      <tr>
        <th data-bind="ltext: 'application.attachmentType'" class="attachment-type">Tyyppi</th>
        <th>Säilytysaika</th>
        <th class="personal-data">Henkilötiedot</th>
        <th class="stamped">Leimattu</th>
        <th data-bind="if: $parent.showWillPublish" class="will-publish">Julkaistaan</th>
      </tr>

      <!-- ko foreach: attachments -->
      <tr class="attachment-row">
        <td class="attachment-type">
          <div class="attachment-type-container" data-bind="click: function(){$data.showAdditionalControls(!showAdditionalControls())}">
            <div class="group-label">
              <span data-bind="if: type">
                <span data-bind="text: loc(['attachmentType', type['type-group'](), '_group_label'])"></span>
              </span>
              <span data-bind="if: !type">
                <i data-bind="ltext: 'attachment.noName'"></i>
              </span>
            </div>
            <div class="type-id">
              <div>
                <span data-bind="if: type">
                  <span data-bind="text: loc(['attachmentType', type['type-group'](), type['type-id']()])"></span>
                </span>
                <span data-bind="if: !type">
                  <i data-bind="ltext: 'attachment.noName'"></i>
                </span>
              </div>
              <!-- ko if: $data.contents -->
              <div class="attachment-content-desc"><span data-bind="text: $data.contents"></span></div>
              <!-- /ko -->
            </div>
          </div>

          <div data-bind="slider: $data.showAdditionalControls" class="additional-controls">
            <div>
              <label>
                <h4>Vaihda liitteen tyyppi</h4>
                <select id="attachment-type-select" class="long" data-bind="foreach: $parents[1].attachmentTypes, value: attachmentType">
                  <optgroup data-bind="attr: {label: groupLabel}, foreach: types">
                    <option data-bind="text: typeLabel, value: typeValue"></option>
                  </optgroup>
                </select>
              </label>
            </div>
            <div data-bind="if: !_.isEmpty($data.metadata)">
              <div data-bind="component: {name: 'metadata-editor',
                                          params: {attachmentId: id, metadata: metadata, applicationId: $root.application.id,
                                          saveCallback: function(){$data.showAdditionalControls(false);}}}"></div>
            </div>
          </div>
        </td>

        <td data-bind="click: function(){$data.showAdditionalControls(!showAdditionalControls())}, text: retentionDescription"></td>
        <td class="personal-data" data-bind="click: function(){$data.showAdditionalControls(!showAdditionalControls())}, text: personalDataDescription"></td>
        <td class="stamped">
          <i class="lupicon-circle-stamp enabled" data-bind="visible: stamped, attr: {title: loc('attachment.stamped')}"></i>
          <i class="lupicon-remove disabled" data-bind="visible: !stamped(), attr: {title: loc('attachment.stamped')}"></i>
        </td>
        <td data-bind="if: $parents[1].showWillPublish, click: function(){$data.showAdditionalControls(!showAdditionalControls())}" class="will-publish">
          <i data-bind="visible: metadata()['myyntipalvelu']" class="lupicon-check enabled"></i>
          <i data-bind="visible: !metadata()['myyntipalvelu']()" class="lupicon-remove disabled"></i>
        </td>
      </tr>
      <!-- /ko -->
      </tbody>
    </table>
  </script>

  <script type="text/html" id="archival-summary-document-table">
    <table class="table archival-summary-table">
      <tbody>
      <tr class="attachment-group-header">
        <td colspan="5">Hankkeen pääasiakirjat</td>
      </tr>

      <tr>
        <th data-bind="ltext: 'application.attachmentType'" class="attachment-type">Tyyppi</th>
        <th>Säilytysaika</th>
        <th class="personal-data">Henkilötiedot</th>
        <th class="stamped"></th>
        <th data-bind="if: $data.showWillPublish" class="will-publish">Julkaistaan</th>
      </tr>

      <!-- ko foreach: documents -->
      <tr class="attachment-row">
        <td class="attachment-type">
          <div class="attachment-type-container" data-bind="click: function(){$data.showAdditionalControls(!showAdditionalControls())}">
            <div data-bind="ltext: documentNameKey"></div>
          </div>

          <div data-bind="if: !_.isEmpty($data.metadata)">
            <div data-bind="slider: $data.showAdditionalControls,
                          component: {name: 'metadata-editor',
                                      params: {metadata: metadata, applicationId: $root.application.id,
                                      saveCallback: function(){$data.showAdditionalControls(false);}}}"></div>
          </div>
        </td>

        <td data-bind="click: function(){$data.showAdditionalControls(!showAdditionalControls())}, text: retentionDescription"></td>
        <td class="personal-data" data-bind="click: function(){$data.showAdditionalControls(!showAdditionalControls())}, text: personalDataDescription"></td>
        <td class="stamped"></td>
        <td data-bind="if: $parent.showWillPublish, click: function(){$data.showAdditionalControls(!showAdditionalControls())}" class="will-publish">
          <i data-bind="visible: metadata()['myyntipalvelu']" class="lupicon-check enabled"></i>
          <i data-bind="visible: !metadata()['myyntipalvelu']()" class="lupicon-remove disabled"></i>
        </td>
      </tr>
      <!-- /ko -->
      </tbody>
    </table>
  </script>

</section>
</body>
</html>
