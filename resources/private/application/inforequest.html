<!DOCTYPE html>
<html lang="en">
<body>
  <section class="page" id="inforequest">

    <div class="breadcrumb" data-bind="with: application">
      <a href="#!/applications" data-bind="ltext: 'requests'" data-test-id="inforequest-requests"></a>
      <span>/</span>
      <span data-bind="text: title" data-test-id="inforequest-title"></span>
    </div>

    <div class="application_summary">
      <div id="inforequest-map" class="map map-large" style="width: 280px; height: 280px;"></div>

      <div data-bind="with: application">
        <h1 data-bind="text: address">
        </h1>

        <div class="application_summary_info">
          <div>
            <p data-bind="ltext: ''">Käsittelytunnus:</p>
            <span data-bind="text: id" data-test-id="inforequest-application-id" class="application_summary_text"></span>
          </div>
          <div data-bind="if: state">
            <p data-bind="ltext: ''">Tila:</p>
            <span id="test-inforequest-state" class="application_summary_text" data-bind="text: loc('inforequest_' + state())"></span>
          </div>
          <div data-bind="with: $root.applicationModel.data">
            <p data-bind="ltext: ''">Luotu:</p>
            <span data-bind="if: $data.created"><span class="application_summary_text" data-bind="dateString: created"></span></span>
          </div>

          <!-- ko if: $root.authorization.ok('assign-application') -->
            <div>
              <p data-bind="ltext: ''">Käsittelijä:</p>
              <span id="test-inforequest-assignee" class="application_summary_text">

                <select id="inforequest-assignee-select"
                        data-bind="options: $root.authorities,
                                   optionsText: function(item) {
                                    return item.firstName + ' ' + item.lastName;
                                   },
                                   optionsValue: 'id',
                                   value: $root.application.assignee,
                                   optionsCaption: loc('choose')"></select>
               </span>
            </div>
          <!-- /ko -->

        </div>
        <div class="inforequest_actions">
          <button data-bind="ltext: 'inforequest.markInforequestAnswered', enable: $root.authorization.ok('mark-inforequest-answered'), click: markInforequestAnswered" data-test-id="inforequest-mark-answered" type="submit" class="btn btn-primary">Merkitse vastatuksi</button>
          <button data-bind="ltext: 'inforequest.convertToApplication', enable: $root.authorization.ok('convert-to-application'), click: convertToApplication" data-test-id="inforequest-convert-to-application" type="submit" class="btn btn-primary">Aloita luvan hakeminen</button>
        </div>
      </div>
    </div>
    <div class="sidebar">
      <aside class="instructions">
        <h3 data-bind="ltext: 'help'">Ohje</h3>
        <p data-bind="ltext: ''">Tässä näkymässä voit käsitellä neuvontapyynnön tietoja.</p>
      </aside>
    </div>

    <div class="container">
      <p class="tab-info" data-bind="ltext: ''">Liitteet</p>
      
      <div data-bind="if: attachments().length">
        <table class="table" data-test-id="inforequest-attachments-table">
          <tbody>
            <tr>
              <th data-bind="ltext: ''">Tiedosto</th>
              <th data-bind="ltext: ''">Muokattu</th>
              <th></th>
            </tr>
            <!-- ko foreach: attachments -->
            <tr>
              <td>
                <span data-bind="if: latestVersion && latestVersion.filename">
                  <a href="#" data-bind="text: latestVersion.filename, attr: {href: '/api/download/' + latestVersion.fileId}"></a><br/>
                  <i data-bind="ltext: latestVersion.contentType"></i>
                  <i data-bind="size: latestVersion.size"></i>
                </span>
              </td>
              <td>
                <span data-bind="dateString: modified"></span>
                <span data-bind="if: $data.latestVersion">
                  <span data-bind="fullName: latestVersion.user"></span>
                </span>
              </td>
              <td>
              </td>
            </tr>
            <!-- /ko -->
          </tbody>
        </table>
      </div>
      
      <div data-bind="ifnot: attachments().length">
        <i data-bind="ltext: ''" data-test-id="inforequest-attachments-no-attachments">Ei liitteit&auml;</i>
      </div>
      
      <button
          class="btn btn-primary modal"
          data-bind="visible: $root.authorization.ok('upload-attachment'), click: attachment.newAttachment"
          data-window-id="upload-dialog">
        Lis&auml;&auml; liite
      </button>
    </div>

    <div data-bind="with: $root.comment">
        <p class="tab-info" data-bind="ltext: 'inforequest.comments'"></p>
        <div class="tab-wrapper">
          <table data-test-id="comments-table" class="table table-striped conversation">
            <tbody data-bind="foreach: comments">
              <tr class="comment inforequest-comment">
                <td class="comment-party commenttd">
                  <span data-bind="dateTimeString: created" class="date"></span>
                  <br />
                  <span data-bind="fullName: user" class="author"></span>
                  <br />
                  <!-- span class="author" data-bind="fullName: user"></span><br/  TODO: Does not woek -->
                  <b>(<span class="role" data-bind="ltext: user.role"></span>)</b>
                </td>
                <td class="commenttd" data-bind="text: text">
                </td>
              </tr>
            </tbody>
          </table>
          <form>
            <h3 data-bind="ltext: ''">Kirjoita viesti:</h3>
            <textarea class="form-input textarea" id="commentText" data-bind="value: text, valueUpdate: 'afterkeydown'" rows="3" placeholder="Kirjoita viesti"></textarea>
            <button id="application.addComment" data-bind="disable: disabled, click: submit" type="submit" class="btn btn-primary">L&auml;het&auml; viesti</button>
          </form>
        </div>
      </div>
  </section>
</body>
</html>
