<!DOCTYPE html>
<html lang="en">
<body>
  <section class="page" id="application" data-bind="with: application">
      <div class="breadcrumb">
        <a href="#!/applications" id="test-applications">Omat hakemukset</a> / <span data-bind="text: title"></span>
      </div>
      <div class="application_summary">
        <div id="application-map" class="todo map" style="width: 280px; height: 220px;"></div>
        <h1 data-bind="with: address">
          <span id="test-application-street" data-bind="text: street"></span>,
          <span data-bind="text: zip"></span> <span data-bind="text: city"></span>
        </h1>

        <div class="application_summary_info">
          <div>
            <p>Lupatunnus:</p>
            <span class="application_summary_text" data-bind-test-id="application-id" data-bind="text: id()"></span>
          </div>
          <div>
            <p>Tila:</p>
            <span id="test-application-state" class="application_summary_text" data-bind="ltext: state()"></span>
          </div>
          <div>
            <p>Lupatyyppi:</p>
            <span class="application_summary_text" data-bind="ltext: permitType()"></span>
          </div>
          <div>
<!-- \/ \/ \/ \/ \/ -->
            <p>Toimenpiteet:</p>
            <ul data-bind="foreach: $root.documents">
              <li>
                <span data-bind="text: schema.info.name" id="test-application-operation"></span>
                <i>(<span data-bind="text: created"></span>)</i>
              </li>
            </ul>
<!-- /\ /\ /\ /\ /\ -->
          </div>
          <div>
            <p>Hakemus luotu:</p>
            <span class="application_summary_text" data-bind="dateString: created"></span>
          </div>
        </div>
        <div class="application_actions">
          <button id="test-submit-application" data-bind="enable: $root.authorization.ok('submit-application'), click: submitApplication" type="submit" class="btn btn-primary">Jätä hakemus käsiteltäväksi</button>
          <button id="test-approve-application" data-bind="enable: $root.authorization.ok('approve-application'), click: approveApplication" type="submit" class="btn btn-primary">Siirrä kuntarekisteriin</button>
          <button class="todo btn btn-large action-bar-button" data-bind="enable:false">Kysy neuvoa</button>
          <button class="todo btn btn-large action-bar-button" data-bind="enable:false">Lisää toimenpide</button>
          <button class="todo btn btn-large action-bar-button" data-bind="enable:false">Poista hakemus</button>
        </div>
      </div>
      <div class="sidebar">
        <button class="todo btn btn-large btn-success action-bar-button" style="display: none">Tallenna</button>
        <aside class="instructions">
          <h3>Ohje</h3>
          <p>Tässä näkymässä voit käsitellä hakemuksen tietoja. Voit kysyä tarvittaessa neuvoa rakennusvalvonnasta keskusteluketjussa. Voit jättää valmiin hakemuksen käsittelyyn painamalla "Jätä hakemus" nappia. Tällöin rakennusvirannomainen tarkistaa hakemuksesi ja ottaa sen käsittelyyn. Tehtyään päätöksen rakennusviranomainen siirtää hakemuksen tilaan hyväksytty tai evätty. Varsinaisen päätöspöytäkirjan löydät "Päätös"-välilehdeltä</p>
        </aside>
      </div>
      <div id="tabs_container">
        <ul id="tabs">
          <li class="active"><a id="test-application-tab" data-bind="click: $root.tab.tabClick, clickBubble: false" href="#application_tab">Hakemuksen tiedot</a></li>
          <li><a id="test-attachments-tab" data-bind="click: $root.tab.tabClick, clickBubble: false" href="#attachments_tab">Liitteet</a></li>
          <li><a data-bind="click: $root.tab.tabClick, clickBubble: false" href="#hearings_tab">Naapurien kuuleminen</a></li>
          <li><a data-bind="click: $root.tab.tabClick, clickBubble: false" href="#pleadings_tab">Lausunnot</a></li>
          <li><a id="test-conversation-tab" data-bind="click: $root.tab.tabClick, clickBubble: false" href="#conversation_tab">Keskusteluketju</a></li>
          <li><a id="test-verdict-tab" data-bind="click: $root.tab.tabClick, clickBubble: false" href="#decision_tab">Päätös</a></li>
        </ul>
      </div>
      <div id="tab_content_container" class="container">
        <div class="tab_content" id="application_tab" style="display: block;">
          
<!-- \/ \/ \/ \/ \/ -->
        <div class="application_section">
          <div id="docgen">
            <!-- This is where generated document will be placed. -->
          </div>
        </div>
<!-- /\ /\ /\ /\ /\ -->
          
          <div class="application_section">
            <h2 class="application_section_header" data-bind="click: $root.accordian.accordianClick, clickBubble: false">Hakemuksen perustiedot</h2>
            <div class="application_section_content content_expanded">
              <h3>Hakija</h3>
<!--
              <ul data-bind="with: documents">
                <li><b>Nimi:</b> <span name="test-applicant-name" data-bind="text: hakija.nimi"></span><br/>
                    <b>Katuosoite:</b> <span name="test-applicant-street" data-bind="text: hakija.address.street"></span><br/>
                    <b>Postinumero:</b> <span name="test-applicant-zip" data-bind="text: hakija.address.zip"></span><br/>
                    <b>Postitoimipaikka:</b> <span name="test-applicant-city" data-bind="text: hakija.address.city"></span><br/>
                    <b>Puh:</b> <span data-bind="text: hakija.puhelinnumero"></span><br/>
                    <b>Sähköpostiosoite:</b> <span name="test-applicant-email" data-bind="text: hakija.sahkopostiosoite"></span><br/>
                 </li>
              </ul>
-->
              <br/>
                <div>
                  <h3>Valtuutetut</h3>
                  <div data-bind="with: $root.applicationModel">
                    <ul data-bind="foreach: auth">
                      <li>
                        <span data-bind="text: firstName"></span> <span data-bind="text: lastName"></span>
                        (<span data-bind="text: username"></span>)
                        <i><span data-bind="foreach: roles"><span data-bind="text: loc($data)"></span> </span></i>
                        <a class="remove-read" href="#" data-bind="click: $root.application.removeAuth">Poista</a>
                      </li>
                    </ul>
                  </div>
                  <br/>
                </div>
                <h3>Kutsutut</h3>

                <ul data-bind="foreach: invites">
                  <li class="user-invite">
                    <span data-bind="text: user.username"></span>
                    (<span data-bind="text: user.firstName"></span> <span data-bind="text: user.lastName"></span>)
                    - <span data-bind="text: text"></span>
                    <a class="remove-invite" href="#" data-bind="click: $root.application.removeInvite">Poista</a>
                  </li>
                </ul>

                <div data-bind="with: $root.invite">
                  <table data-bind="visible: $root.authorization.ok('invite')">
                    <tr><td>sähköpostiosoite</td><td><input id="invite-email" class="form_input" type="text" data-bind="value: email" /></td></tr>
                    <tr><td>teksti          </td><td><textarea id="invite-text" rows=5 class="form_input" data-bind="value: text"></textarea></td></tr>
                    <tr ><td>&nbsp;         </td><td><a href="#" id="test-invite" data-bind="click: submit">kutsu uusi suunnittelija</a></td></tr>
                  </table>
                </div>
              </div>
            </div>
          </div>
        <div class="tab_content" id="hearings_tab">TPD</div>
        <div class="tab_content" id="pleadings_tab">TPD</div>
        <div class="tab_content" id="attachments_tab">
          <div class="tab-wrapper">
            <table data-bind="if: attachments && attachments().length"
                   class="table table-striped">
              <thead>
                <tr>
                  <th>Tila</th>
                  <th>Tyyppi</th>
                  <th>Tiedosto</th>
                  <th>Versio</th>
                  <th>Muokattu</th>
                  <th></th>
                </tr>
              </thead>
              <tbody data-bind="foreach: attachments">
              <tr style="cursor: pointer;">
                  <td data-bind="text: loc('attachmentState_' + state)"
                      class="attachment-state"></td>
                  <td data-bind="attr: {onclick: open}">
                    <a id="test-attachment-type-link" data-bind="attr: {href: '#!/attachment/' + $root.application.id() + '/' + id }">
                      <span data-bind="if: type != null && type.length > 0"><span data-bind="text: type"></span></span>
                      <span data-bind="if: type == null || type.length == 0"> <i>Nimetön</i></span>
                    </a>
                  </td>
                <td><span data-bind="if: $data.latestVersion.filename">
                    <a href="" data-bind="text: loc('view') + ' ' + latestVersion.filename, attr: {href: '/rest/view/' + latestVersion.fileId}" target="_blank"></a> -
                    <a href="" data-bind="text: loc('download') + ' ' + latestVersion.filename, attr: {href: '/rest/download/' + latestVersion.fileId}"></a>
                    <i data-bind="ltext: latestVersion.contentType"></i> <i data-bind="size: latestVersion.size"></i>
                </span></td>
                  <td data-bind="if: $data.latestVersion"><span data-bind="version: latestVersion.version"></span></td>
                  <td data-bind="if: $data.modified">
                    <span data-bind="dateString: modified"></span>
                    <span data-bind="if: $data.latestVersion"><span data-bind="fullName: latestVersion.user"></span></span>
                  </td>
                  <td></td>
              </tr>
              </tbody>
            </table>
            <div data-bind="ifnot: attachments && attachments().length">
              <i>Ei liitteitä</i>
            </div>
            <button id="add-attachment" class="btn btn-success"
                    data-bind="visible: $root.authorization.ok('create-attachment'),click: attachment.newAttachment"
            >Lisää liite</button>


            <iframe id="uploadFrame"
                    src="/html/pages/upload.html"
                    style="height: 300px; width: 100%, min-width: 300px; display: none; border:0; overflow: hidden;"
            ></iframe>

          </div>
        </div>
        <div class="tab_content" id="conversation_tab">
          <div class="tab-wrapper">
                        <div class="span12">Keskustele hakemuksesta:</div>
            <table class="table table-striped">
              <tbody data-bind="foreach: comments">
                <tr class="comment">
                  <td class="commentParty">
                    <span class="date" data-bind="dateTimeString: created"></span><br/>
                    <span class="author" data-bind="text: user.firstName()+' '+user.lastName()"></span><br/>
                    <!-- span class="author" data-bind="fullName: user"></span><br/  TODO: Does not woek -->
                    <b>(<span class="role" data-bind="ltext: user.role"></span>)</b>
                  </td>
                  <td data-bind="text: text"></td>
                </tr>
              </tbody>
            </table>
            <form class="well" data-bind="with: $root.comment">
              <div class="row">
                <div class="span12">Keskustele hakemuksesta:</div>
              </div>
              <div class="row">&nbsp;</div>
              <textarea class="input-xlarge span5" id="commentText" data-bind="value: text, valueUpdate: 'afterkeydown'" rows="3" placeholder="Kirjoita viesti"></textarea>
              <div class="btn-toolbar">
                <button id="application.addComment" data-bind="disable: disabled, click: submit" type="submit" class="add-comment btn btn-primary">Lähetä viesti</button>
              </div>
            </form>
          </div>
        </div>
        <div class="tab_content" id="decision_tab">
          <div class="tab-wrapper">
            <div class="row" data-bind="with: verdict">
              <span id="test-application-verdict" data-bind="text: text"></span>
            </div>
          </div>
        </div>
      </div>
  </section>
</body>
</html>