<!DOCTYPE html>
<html lang="en">
<body>
  <section class="page" id="application" data-bind="with: application">
    <div class="breadcrumb">
      <a href="#!/applications" id="test-applications">Omat hakemukset</a> / <span data-bind="text: title"></span>
    </div>
    <div class="application_summary">
      <div id="application-map" class="todo map" style="width: 280px; height: 220px;"></div>
      <h1 data-bind="with: address">
        <span id="test-application-street" data-bind="text: street"></span>, <span data-bind="text: zip"></span> <span data-bind="text: city"></span>
      </h1>

      <div class="application_summary_info">
        <div>
          <p>Lupatunnus:</p>
          <span class="application_summary_text" data-bind-test-id="application-id" data-bind="text: id()"></span>
        </div>
        <div>
          <p>Tila:</p>
          <span id="test-application-state" class="application_summary_text" data-bind="ltext: state()"></span>
        </div>
        <div>
          <p>Lupatyyppi:</p>
          <span class="application_summary_text" data-bind="ltext: permitType()"></span>
        </div>
        <div>
          <p>Toimenpiteet:</p>
          <ul data-bind="foreach: $root.documents">
            <li>
              <span data-bind="ltext: schema.info.name" id="test-application-operation"></span>
              <i>(<span data-bind="dateTimeString: created"></span>)</i>
            </li>
          </ul>
        </div>
        <div>
          <p>Hakemus luotu:</p>
          <span class="application_summary_text" data-bind="dateString: created"></span>
        </div>
      </div>
      <div class="application_actions">
        <button id="test-submit-application" data-bind="enable: $root.authorization.ok('submit-application'), click: submitApplication" type="submit" class="btn btn-primary">Jätä hakemus käsiteltäväksi</button>
        <button id="test-approve-application" data-bind="enable: $root.authorization.ok('approve-application'), click: approveApplication" type="submit" class="btn btn-primary">Siirrä kuntarekisteriin</button>
        <button class="todo btn btn-large action-bar-button" data-bind="enable:false">Kysy neuvoa</button>
        <button class="todo btn btn-large action-bar-button" data-bind="enable:false">Lisää toimenpide</button>
        <button class="todo btn btn-large action-bar-button" data-bind="enable:false">Poista hakemus</button>
      </div>
    </div>
    <div class="sidebar">
      <button class="todo btn btn-large btn-success action-bar-button" style="display: none">Tallenna</button>
      <aside class="instructions">
        <h3>Ohje</h3>
        <p>Tässä näkymässä voit käsitellä hakemuksen tietoja. Voit kysyä tarvittaessa neuvoa rakennusvalvonnasta keskusteluketjussa. Voit jättää valmiin hakemuksen käsittelyyn painamalla "Jätä hakemus" nappia. Tällöin rakennusvirannomainen tarkistaa hakemuksesi ja ottaa sen käsittelyyn. Tehtyään päätöksen rakennusviranomainen siirtää hakemuksen tilaan hyväksytty tai evätty. Varsinaisen päätöspöytäkirjan löydät "Päätös"-välilehdeltä</p>
      </aside>
    </div>
    <div id="tabs_container">
      <ul id="tabs">
        <li class="active"><a id="test-application-tab" data-bind="click: $root.tab.tabClick, clickBubble: false" href="#application_tab">Hakemuksen tiedot</a></li>
        <li><a id="test-attachments-tab" data-bind="click: $root.tab.tabClick, clickBubble: false" href="#attachments_tab">Liitteet</a></li>
        <li><a id="test-conversation-tab" data-bind="click: $root.tab.tabClick, clickBubble: false" href="#conversation_tab">Keskusteluketju</a></li>
        <li><a id="test-verdict-tab" data-bind="click: $root.tab.tabClick, clickBubble: false" href="#decision_tab">Päätös</a></li>
      </ul>
    </div>
    <div id="tab_content_container" class="container">

      <!-- docgen generated content: -->
      <div class="tab_content" id="application_tab" style="display: block;">
        <div class="application_section">
          <div id="docgen">
            <!-- This is where generated document will be placed. -->
          </div>
        </div>
      </div>

      <div class="tab_content" id="conversation_tab">
        <div class="tab-wrapper">
          <div class="span12">Keskustele hakemuksesta:</div>
          <table class="table table-striped">
            <tbody data-bind="foreach: comments">
              <tr class="comment">
                <td class="commentParty"><span class="date" data-bind="dateTimeString: created"></span><br /> <span class="author" data-bind="text: user.firstName()+' '+user.lastName()"></span><br /> <!-- span class="author" data-bind="fullName: user"></span><br/  TODO: Does not woek --> <b>(<span class="role" data-bind="ltext: user.role"></span>)
                </b></td>
                <td data-bind="text: text"></td>
              </tr>
            </tbody>
          </table>
          <form class="well" data-bind="with: $root.comment">
            <div class="row">
              <div class="span12">Keskustele hakemuksesta:</div>
            </div>
            <div class="row">&nbsp;</div>
            <textarea class="input-xlarge span5" id="commentText" data-bind="value: text, valueUpdate: 'afterkeydown'" rows="3" placeholder="Kirjoita viesti"></textarea>
            <div class="btn-toolbar">
              <button id="application.addComment" data-bind="disable: disabled, click: submit" type="submit" class="add-comment btn btn-primary">Lähetä viesti</button>
            </div>
          </form>
        </div>
      </div>

      <div class="tab_content" id="decision_tab">
        <div class="tab-wrapper">
          <div class="row" data-bind="with: verdict">
            <span id="test-application-verdict" data-bind="text: text"></span>
          </div>
        </div>
      </div>

      <div class="tab_content" id="attachments_tab">
        <div class="tab-wrapper">
          <table data-bind="if: attachments && attachments().length" class="table table-striped">
            <thead>
              <tr>
                <th>Tila</th>
                <th>Tyyppi</th>
                <th>Tiedosto</th>
                <th>Versio</th>
                <th>Muokattu</th>
                <th></th>
              </tr>
            </thead>
            <tbody data-bind="foreach: attachments">
            <tr style="cursor: pointer;" data-bind="if: $data.type || $data.modified">
                <td data-bind="text: loc('attachmentState_' + state)"
                    class="attachment-state"></td>
                <td data-bind="click: function() { window.location.hash='#!/attachment/' + $root.application.id() + '/' + id;}">
                  <a id="test-attachment-type-link" data-bind="attr: {href: '#!/attachment/' + $root.application.id() + '/' + id }">
                    <span data-bind="if: type != null && type.length > 0"><span data-bind="text: type"></span></span>
                    <span data-bind="if: type == null || type.length == 0"> <i>Nimetön</i></span>
                  </a>
                </td>
              <td><span data-bind="if: $data.latestVersion.filename">
                  <a href="" data-bind="text: loc('view') + ' ' + latestVersion.filename, attr: {href: '/rest/view/' + latestVersion.fileId}" target="_blank"></a> -
                  <a href="" data-bind="text: loc('download') + ' ' + latestVersion.filename, attr: {href: '/rest/download/' + latestVersion.fileId}"></a>
                  <i data-bind="ltext: latestVersion.contentType"></i> <i data-bind="size: latestVersion.size"></i>
              </span></td>
                <td data-bind="version: latestVersion.version"></td>
                <td>
                  <span data-bind="dateString: modified"></span>
                  <span data-bind="fullName: latestVersion.user"></span>
                </td>
                <td></td>
            </tr>
            </tbody>
          </table>
          <div data-bind="ifnot: attachments && attachments().length">
            <i>Ei liitteitä</i>
          </div>
          <button
              id="add-attachment"
              class="btn btn-success modal"
              data-window-id="upload-dialog"
              data-bind="visible: $root.authorization.ok('upload-attachment'),click: attachment.newAttachment">
            Lisää liite
          </button>
          <div id="upload-dialog" class="window">
            <div class="dialog-header">
              <p>Tallenna tiedosto</p>
              <p class="dialog-close close">X</p>
            </div>
            <div class="dialog-content">
              <iframe
                  id="uploadFrame"
                  src="/html/pages/upload.html"
                  style="height: 300px; width: 100%, min-width: 300px; border:0; overflow: hidden;">
              </iframe>
            </div>
          </div>
        </div>
      </div>
      
    </div>

    <div id="boxes">
       
      <div id="dialog-valtuutus" class="window">
        <div class="dialog-header">
           
          <p>Lisää valtuutus</p>
           
          <p class="dialog-close close">X</p>
        </div>
        <div class="dialog-content">
          <div data-bind="with: $root.invite">
            <table>
              <tr>
                <td>Sähköpostiosoite</td>
                <td><input id="invite-email" class="form_input text long" type="text" data-bind="value: email" /></td>
              </tr>
              <tr>
                <td>Viesti</td>
                <td><textarea id="invite-text" rows=5 class="form_input text long" data-bind="value: text"></textarea></td>
              </tr>
            </table>
            <button class="btn btn-primary close" id="test-ask-for-planner" data-bind="click: submit">Kutsu</button>

          </div>
        </div>
      </div>

    </div>
  </section>
</body>
</html>
