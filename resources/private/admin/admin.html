<!DOCTYPE html>
<html lang="en">
<body>
  <section class="page" id="admin">
    <div class="container">
      <div class="breadcrumb">
        <a href="#!/admin" data-bind="ltext: 'auth-admin.title'"></a>
      </div>
      <h1 id="admin-header" data-bind="ltext: 'auth-admin.title'"></h1>

      <section>
        <h2 data-bind="ltext: 'admin.admin-users'"></h2>
        <table class="table table-striped tablesorter" id="test-authority-admin-users-table">
          <thead>
            <tr>
              <th data-bind="ltext: 'auth-admin.user'"></th>
              <th data-bind="ltext: 'userinfo.email'"></th>
              <th data-bind="ltext: 'auth-admin.role'"></th>
              <th data-bind="ltext: 'auth-admin.actions'"></th>
              <th data-bind="ltext: 'auth-admin.active'"></th>
            </tr>
          </thead>
          <tbody data-bind="foreach: users.data()">
            <tr class="user-row">
              <td class="user-full-name"><a data-bind="text: firstName()+' '+lastName(), attr: { 'data-test-full-name-by-email': email }"></a></td>
              <td data-bind="text: email"></td>
              <td data-bind="ltext: role()"></td>
              <td>
                [<a class="edit-user" href="#" data-bind="ltext: 'edit', click: $root.users.openAdminModifyModal, attr: { 'data-test-edit-email': email }" class="modal"></a>]
                [<a class="change-user-password" href="#" data-bind="ltext: 'userinfo.changePassword', click: $root.users.openAdminPasswordModal, attr: { 'data-test-password-email': email }" class="modal"></a>]
              </td>
              <td data-bind="text: enabled() ? loc('auth-admin.user-active') : ''"></td>
            </tr>
          </tbody>
        </table>
        <a href="#" data-bind="click: $root.users.openCreateAdminModal, ltext: 'admin.addAdminUser'" class="modal btn btn-primary btn-narrow" id="test-create-admin-user"></a>
      </section>
      
      <h3>Fixturet <span data-bind="visible: fixtures.ok" data-test-id="fixture-done">Done</span></h3>
      <ul data-bind="foreach: fixtures.data()">
        <li>
          <a href="#" data-bind="text: $data, click: $root.fixtures.apply"></a>
        </li>
      </ul>
      <h3>P&auml;&auml;t&ouml;kset</h3>
      <ul data-bind="foreach: applications.data()">
        <li><a href="#" data-bind="text: id, click: $root.applications.giveVerdict, attr: {'data-test-id': id}"></a></li>
      </ul>
      <b data-bind="text: applications.verdictResult" data-test-id="admin-verdict-result"></b>
      <h3>Aktivoi tili</h3>
      <ul data-bind="foreach: activations.data()">
        <li><a href="#" data-bind="text: email, click: $root.activations.activate"></a></li>
      </ul>
      <h3>Toiminnot</h3>
      <table>
        <thead>
          <th>status</th>
          <th>toiminto</th>
          <th>tyyppi</th>
          <th>roolit</th>
          <th>parametrit</th>
          <th>l&auml;hdekoodi</th>
          <th>kuvaus</th>
        </thead>
        <tbody data-bind="foreach: actions.data">
          <tr>
            <td data-bind="attr: {class: $data.verified === true ? 'btn-primary' : 'btn-decline'}">
            </td>
            <td data-bind="text: name"></td>
            <td data-bind="text: type"></td>
            <td>
              <!-- ko if: $data.roles -->
              <ul data-bind="foreach: roles">
                <li data-bind="text: $data"></li>
              </ul>
              <!-- /ko -->
            </td>
            <td>
              <!-- ko if: $data.parameters -->
              <ul data-bind="foreach: parameters">
                <li data-bind="text: $data"></li>
              </ul>
              <!-- /ko -->
            </td>
            <td>
              <span data-bind="text: ns"></span>: <span data-bind="text: line"></span>
            </td>
            <td>
              <!-- ko if: $data.description -->
                <span data-bind="text: description"></span>
              <!-- /ko -->
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div id="dialog-add-user" class="window autosized">
      <div class="dialog-header">
        <p data-bind="ltext: 'admin.addAdminUser'"></p>
        <p class="dialog-close close">X</p>
      </div>

      <div class="dialog-content">
        <div data-bind="with: $root.editUser">
          <label class="form-label" for="user-municipality" data-bind="ltext: 'admin.selectAdminMunicipality'"></label><br />
          <select id="user-municipality"
            data-bind="options: $root.municipalities.municipalities,
                       optionsText: function(m) { return loc('municipality', m.id); },
                       optionsValue: 'id',
                       value: municipality,
                       optionsCaption: loc('choose')"
            data-test-id="add-admin-municipality-select">
<!--            class="form-select form-input combobox long"> -->
          </select>
          <br />
          <label class="form-label" for="user-email" data-bind="ltext: 'userinfo.email'"></label>
          <input class="form-input text long" id="user-email" type="text" data-bind="value: email, valueUpdate: 'afterkeydown'" />
          <label class="form-label" for="user-firstname" data-bind="ltext: 'userinfo.firstName'"></label>
          <input class="form-input text long" id="user-firstname" type="text" data-bind="value: firstname, valueUpdate: 'afterkeydown'" />
          <label class="form-label" for="user-lastname" data-bind="ltext: 'userinfo.lastName'"></label>
          <input class="form-input text long" id="user-lastname" type="text" data-bind="value: lastname, valueUpdate: 'afterkeydown'" />
          <label class="form-label" for="user-password" data-bind="ltext: 'userinfo.password'"></label>
          <input class="form-input text long" id="user-password" type="password" data-bind="value: password, valueUpdate: 'afterkeydown'" />
          <span data-bind="text: loc('mypage.quality.' + quality()), attr: {'class': quality}, visible: password() && password().length > 0"></span>
          <button id="test-create-user-save" class="btn btn-primary btn-dialog close" data-bind="click: save, disable: disabled, ltext: 'save'"></button>
        </div>
      </div>
    </div>
    
    <div id="dialog-modify-user" class="window autosized">
      <div class="dialog-header">
        <p data-bind="ltext: 'admin.editAdminUser'"></p>
        <p class="dialog-close close">X</p>
      </div>
      <div class="dialog-content">
        <div data-bind="with: $root.editUser">
          <h3 data-bind="ltext: 'admin.selectAdminMunicipality'">Valitse pääkäyttäjän sijaintikunta:</h3>
          <select
            data-bind="options: $root.municipalities.municipalities,
                       optionsText: function(m) { return loc('municipality', m.id); },
                       optionsValue: 'id',
                       value: municipality,
                       optionsCaption: loc('choose')"
            data-test-id="add-admin-municipality-select">
<!--            class="form-select form-input combobox long">   TODO: Set proper classes here!  -->
          </select>
          <br /><br />
          <label class="form-label" for="user-edit-email" data-bind="ltext: 'userinfo.email'"></label>
          <input class="form-input text long" disabled="disabled" id="user-edit-email" type="text" data-bind="value: email" />
          <label class="form-label" for="user-edit-firstname" data-bind="ltext: 'userinfo.firstName'"></label>
          <input class="form-input text long" id="user-edit-firstname" type="text" data-bind="value: firstname, valueUpdate: 'afterkeydown'" />
          <label class="form-label" for="user-edit-lastname" data-bind="ltext: 'userinfo.lastName'"></label>
          <input class="form-input text long" id="user-edit-lastname" type="text" data-bind="value: lastname, valueUpdate: 'afterkeydown'" />
          <label data-bind="ltext: 'auth-admin.active'" class="form-label" for="user-active"></label>
          <input class="form-input text long" id="user-active" type="checkbox" data-bind="checked: enabled, valueUpdate: 'afterkeydown'" />
          <button class="btn btn-primary btn-dialog close" id="test-edit-user-save" data-bind="click: save, enable: municipalityOk() && editFieldsOk(),ltext: 'save'"></button>
        </div>
      </div>
    </div>
    
    <div id="dialog-reset-password" class="window autosized">
      <div class="dialog-header">
        <p data-bind="ltext: 'userinfo.changePassword'"></p>
        <p class="dialog-close close">X</p>
      </div>
      <div class="dialog-content">
        <div data-bind="with: $root.editUser">
          <label class="form-label" for="user-reset-email" data-bind="ltext: 'userinfo.email'"></label>
          <input class="form-input text long" disabled="disabled" id="user-reset-email" type="text" data-bind="value: email" />
          <label class="form-label" for="user-password" data-bind="ltext: 'userinfo.newPassword'"></label>
          <input class="form-input text long" id="change-user-password" type="password" data-bind="value: password, valueUpdate: 'afterkeydown'" />
          <button class="btn btn-primary btn-dialog close" data-bind="click: save, enable: editFieldsOk(), ltext: 'save'" id="test-change-password-save"></button>
        </div>
      </div>
    </div>

  </section>
</body>
</html>
