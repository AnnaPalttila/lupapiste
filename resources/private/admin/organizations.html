<!DOCTYPE html>
<html>
  <body>
    <section class="page" id="organizations">
      <div class="container">

        <h2>Organizations</h2>

        <table data-test-id="organizations-table">
          <thead>
            <tr>
              <th data-bind="ltext: 'organization.id'"></th>
              <th data-bind="ltext: 'organization.name'"></th>
              <th data-bind="ltext: 'login.with-rights'"></th>
              <th data-bind="ltext: 'organization.archive.enabled'"></th>
              <th data-bind="ltext: 'admin.municipality'"></th>
              <th data-bind="ltext: 'organization.scope'"></th>
              <th data-bind="ltext: 'organization.inforequest.enabled'"></th>
              <th data-bind="ltext: 'organization.application.enabled'"></th>
              <th data-bind="ltext: 'organization.openinforequest.enabled'"></th>
              <th data-bind="ltext: 'organization.openinforequest.email'"></th>
              <th>Palvelu avataan</th>
            </tr>
          </thead>
          <tbody data-bind="foreach: { data: organizationsModel.organizations, as: 'organization' }">
            <!-- ko foreach: scope -->
            <tr>
              <!-- ko if: $data.municipality == organization.scope[0].municipality && $data.permitType == organization.scope[0].permitType-->
                <td data-bind="text: organization.id, attr: {'rowspan': organization.scope.length}"></td>
                <td data-bind="attr: {'rowspan': organization.scope.length}">
                  <a data-bind="text: organization.name[loc.getCurrentLanguage()], click: $parent.open, attr: {'data-test-id': 'edit-organization-' + organization.id}" href="#"></a>
                </td>
                <td data-bind="with: organization, attr: {'rowspan': organization.scope.length}">
                  [<a href="#" data-bind="click: $root.loginAsModel.open, ltext: 'loginframe.login', attr: {'data-impersonate': organization.id}"></a>]
                </td>
                <td data-bind="with: organization, attr: {'rowspan': organization.scope.length}">
                  <span data-bind="text: $data['permanent-archive-enabled'] || false"></span>
                </td>
              <!-- /ko -->
              <td><abbr data-bind="text: $data.municipality, attr: {'title': loc(['municipality',$data.municipality])}"></abbr></td>
              <td><abbr data-bind="text: $data.permitType, attr: {'title':loc($data.permitType)}"></abbr></td>
              <td data-bind="text: $data['inforequest-enabled'] || false, attr: {'data-test-id': 'inforequest-enabled-' + $data.municipality + '-' + $data.permitType}"></td>
              <td data-bind="text: $data['new-application-enabled'] || false, attr: {'data-test-id': 'application-enabled-' + $data.municipality + '-' + $data.permitType}"></td>
              <td data-bind="text: $data['open-inforequest'] || false, attr: {'data-test-id': 'open-inforequest-' + $data.municipality + '-' + $data.permitType}"></td>
              <td data-bind="text: $data['open-inforequest-email'], attr: {'data-test-id': 'open-inforequest-email-' + $data.municipality + '-' + $data.permitType}"></td>
              <td data-bind="dateString: $data['opening']"></td>
            </tr>
            <!-- /ko -->
          </tbody>
        </table>

      </div>

      <div id="dialog-login-as" class="window autosized" data-bind="with: loginAsModel">
        <div class="dialog-header">
          <p data-bind="ltext: 'loginframe.login'"></p>
          <p class="dialog-close close">X</p>
        </div>

        <div class="dialog-content">
          <div>
            <label class="form-label" for="login-as-password" data-bind="ltext: 'admin.admin-password'"></label>
            <input type="password" data-bind="textInput: password" class="form-input" id="login-as-password" >
          </div>

          <button data-bind="click: login, ltext: 'loginframe.login'"
                  data-test-id="submit-login-as"
                  class="btn btn-primary btn-dialog" ></button>

          <a data-bind="ltext: 'cancel'" class="btn-dialog close" href="#"></a>
        </div>
      </div>


    </section>
  </body>
</html>
