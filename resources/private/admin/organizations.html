<!DOCTYPE html>
<html>
  <body>
    <section class="page" id="organizations">
      <div class="container">

        <h2>Organizations</h2>

        <table data-test-id="organizations-table">
          <thead>
            <tr>
              <th data-bind="ltext: 'organization.id'"></th>
              <th data-bind="ltext: 'organization.name'"></th>
              <th data-bind="ltext: 'organization.inforequest.enabled'"></th>
              <th data-bind="ltext: 'organization.application.enabled'"></th>
              <th data-bind="ltext: 'organization.openinforequest.enabled'"></th>
              <th data-bind="ltext: 'organization.openinforequest.email'"></th>
              <th data-bind="ltext: 'edit'"></th>
              <th >Kirjaudu oikeuksin</th>
            </tr>
          </thead>

<!--                     Esimerkki:   kts "attachments" -->

<!--                         <tbody data-bind="foreach: $data.poytakirjat"> -->
<!--                           <tr class="statement-row" > -->
<!--                             <td data-bind="if: $data.status"> -->
<!--                               <span data-bind="ltext: 'verdict.status.'+$data.status"></span></td> -->
<!--                             <td data-bind="text: $data.paatos" class="verdict-text"></td> -->
<!--                             <td data-bind="text: $data.pykala"></td> -->
<!--                             <td data-bind="text: $data.paatoksentekija"></td> -->
<!--                             <td data-bind="dateString: $data.paatospvm"></td> -->
<!--                             <td data-bind="foreach: $data.attachments"> -->
<!--                               <span data-bind="with: $data.latestVersion"> -->
<!--                                 <a href="#" data-bind="text: filename, attr: {href: '/api/raw/download-attachment?attachment-id=' + fileId}"></a><br/> -->
<!--                                   <i data-bind="ltext: contentType"></i> -->
<!--                                   <i data-bind="size: size"></i><br/> -->
<!--                               </span> -->
<!--                             </td> -->
<!--                           </tr> -->
<!--                         </tbody> -->

          <!-- TODO: Tassa vaiheessako OrganizationsModel.organizationsia ei ole viela ladattu? -->

          <tbody data-bind="foreach: { data: organizationsModel.organizations, as: 'organization' }">

            <!-- TODO: Tassa pitaa nyt loopata lapi kaikki scope-arrayssa olevat scopet! -->
            <!-- TODO: Testaa tama: -->

            <div data-bind="foreach: { data: organization.scope, as: 'scope' }">
              <tr>
                <td data-bind="text: organization.id"></td>
                <td data-bind="text: organization.name[loc.getCurrentLanguage()]"></td>
                <td data-bind="text: scope['inforequest-enabled'], attr: {'data-test-id': 'inforequest-enabled-' + organization.id}"></td>
                <td data-bind="text: scope['new-application-enabled'], attr: {'data-test-id': 'application-enabled-' + organization.id}"></td>
                <td data-bind="text: scope['open-inforequest'], attr: {'data-test-id': 'open-inforequest-' + organization.id}"></td>
                <td data-bind="text: scope['open-inforequest-email'], attr: {'data-test-id': 'open-inforequest-email-' + organization.id}"></td>
                <td>[<a href="#" data-bind="click: $root.editOrganizationModel.open, ltext: 'edit', attr: {'data-test-id': 'edit-organization-' + organization.id}" class="modal"></a>]</td>
                <td>[<a href="#" data-bind="click: $root.loginAsModel.open(organization.id), ltext: 'loginframe.login', attr: {'data-impersonate': organization.id}"></a>]</td>
              </tr>
            </div>
          </tbody>
        </table>

      </div>

      <div id="dialog-edit-organization" class="window autosized">
        <div data-bind="with: editOrganizationModel">
          <div class="dialog-header">
            <p data-bind="ltext: 'edit'"></p>
            <p class="dialog-close close">X</p>
          </div>

          <div class="dialog-content">

            <div>
              <div>
                <input type="checkbox" data-bind="checked: inforequestEnabled" data-test-id="inforequest-enabled" class="form-input" id="inforequest-enabled"></input>
                <label for="inforequest-enabled" class="form-label" data-bind ="ltext: 'organization.inforequest.enabled'"></label>
              </div>

              <div>
                <input type="checkbox" data-bind="checked: applicationEnabled" data-test-id="application-enabled" class="form-input" id="application-enabled"></input>
                <label class="form-label" for="application-enabled" data-bind ="ltext: 'organization.application.enabled'"></label>
              </div>

              <div>
                <input type="checkbox" data-bind="checked: openInforequestEnabled" class="form-input" id="open-inforequest"></input>
                <label class="form-label" for="open-inforequest" data-bind ="ltext: 'organization.openinforequest.enabled'"></label>
              </div>

              <div>
                <label class="form-label" for="open-inforequest-email" data-bind ="ltext: 'organization.openinforequest.email'"></label>
                <input type="text" data-bind="value: openInforequestEmail" class="form-input" id="open-inforequest-email" data-test-id="open-inforequest-email"></input>
              </div>

              <button data-bind="click: updateOrganization, enable: ok, disable: processing" class="btn btn-primary btn-dialog" data-test-id="save-organization">
                <span data-bind="ltext: 'save'"></span>
                <em data-bind="visible: pending" class="button-loader"></em>
              </button>

              <a data-bind="ltext: 'cancel'" class="btn-dialog close" href="#"></a>
            </div>

          </div>
        </div>
      </div>


      <div id="dialog-login-as" class="window autosized">
        <div data-bind="with: loginAsModel">
          <div class="dialog-header">
            <p data-bind="ltext: 'loginframe.login'"></p>
            <p class="dialog-close close">X</p>
          </div>

          <div class="dialog-content">
            <div>
              <label class="form-label" for="login-as-password">Admin-salasana</label>
              <input type="password" data-bind="value: password, valueUpdate: 'afterkeydown'" class="form-input" id="login-as-password" ></input>
            </div>

            <button data-bind="click: login, ltext: 'loginframe.login'"
                    data-test-id="submit-login-as"
                    class="btn btn-primary btn-dialog" ></button>

            <a data-bind="ltext: 'cancel'" class="btn-dialog close" href="#"></a>
          </div>
        </div>
      </div>


    </section>
  </body>
</html>
