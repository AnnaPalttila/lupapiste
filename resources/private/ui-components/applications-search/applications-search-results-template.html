<!DOCTYPE html>
<html>
<body>
  <section class="page container">
    <script type="text/html" id="applications-search-results-template">
      <div class="search-tabs">
        <div class="tab-buttons">
          <ul data-bind="foreach: tabs">
            <li data-bind="ltext: 'applications.filter.' + $data, click: $parent.selectTab,
                           css: {selected: $parent.selectedTab() === $data}"></li>
          </ul>
        </div>
        <div>
          <table class="applications-table" data-bind="if: gotResults()">
            <thead>
              <tr>
                <th colspan="4" data-bind="ltext: 'applications.indicators'"></th>
                <th class="sorting" data-bind="click: _.partial(sortBy, 'type'),
                                               ltext: 'applications.type',
                                               css: {asc: dataProvider.sort.field() === 'type' ? dataProvider.sort.asc() : false,
                                                     desc: dataProvider.sort.field() === 'type' ? !dataProvider.sort.asc() : false}"></th>
                <th class="sorting" data-bind="click: _.partial(sortBy, 'location'),
                                               ltext: 'applications.location',
                                               css: {asc: dataProvider.sort.field() === 'location' ? dataProvider.sort.asc() : false,
                                                     desc: dataProvider.sort.field() === 'location' ? !dataProvider.sort.asc() : false}"></th>
                <th data-bind="ltext: 'applications.operation'"></th>
                <th class="sorting" data-bind="click: _.partial(sortBy, 'applicant'),
                                               ltext: 'applications.applicant',
                                               css: {asc: dataProvider.sort.field() === 'applicant' ? dataProvider.sort.asc() : false,
                                                     desc: dataProvider.sort.field() === 'applicant' ? !dataProvider.sort.asc() : false}"></th>
                <th class="sorting" data-bind="click: _.partial(sortBy, 'submitted'),
                                               ltext: 'applications.sent',
                                               css: {asc: dataProvider.sort.field() === 'submitted' ? dataProvider.sort.asc() : false,
                                                     desc: dataProvider.sort.field() === 'submitted' ? !dataProvider.sort.asc() : false}"></th>
                <th class="sorting" data-bind="click: _.partial(sortBy, 'modified'),
                                               ltext: 'applications.updated',
                                               css: {asc: dataProvider.sort.field() === 'modified' ? dataProvider.sort.asc() : false,
                                                     desc: dataProvider.sort.field() === 'modified' ? !dataProvider.sort.asc() : false}"></th>
                <th class="sorting" data-bind="click: _.partial(sortBy, 'state'),
                                               ltext: 'applications.status',
                                               css: {asc: dataProvider.sort.field() === 'state' ? dataProvider.sort.asc() : false,
                                                     desc: dataProvider.sort.field() === 'state' ? !dataProvider.sort.asc() : false}"></th>
                <th class="sorting" data-bind="click: _.partial(sortBy, 'handler'),
                                               ltext: 'applications.authority',
                                               css: {asc: dataProvider.sort.field() === 'handler' ? dataProvider.sort.asc() : false,
                                                     desc: dataProvider.sort.field() === 'handler' ? !dataProvider.sort.asc() : false}"></th>
              </tr>
            </thead>
            <tbody data-bind="foreach: data">
              <tr class="application-row" data-bind="click: pageutil.openApplicationPage">
                <td data-bind="if: $data.authorityNotice || $data.urgency !== 'normal'" class="indicator-count" data-test-col-name="urgent">
                  <div data-bind="attr: {title: _.trim($data.authorityNotice) ? loc('notice.prompt') + ': ' + _.trim($data.authorityNotice) : loc(['notice', 'urgency', $data.urgency]),
                                         class: 'urgency ' + $data.urgency}"></div>
                </td>
                <td data-bind="if: indicators > 0" class="indicator-count" data-test-col-name="indicators">
                  <div data-bind="text: indicators > 99 ? '*' : indicators,
                                  attr: {class: 'unseen-indicators', title: loc('info.title')}"></div>
                </td>
                <td data-bind="if: unseenComments > 0" class="indicator-count" data-test-col-name="unseenComments">
                  <div data-bind="text: unseenComments > 99 ? '*' : unseenComments,
                                    attr: {class: 'unseen-comments', title: loc('conversation.title')}"></div>
                </td>
                <td data-bind="if: attachmentsRequiringAction > 0" class="indicator-count" data-test-col-name="newAttachments">
                  <div data-bind="text: attachmentsRequiringAction > 99 ? '*' : attachmentsRequiringAction,
                                    attr: {class: 'unseen-attachments', title: loc('attachments.title')}"></div>
                </td>
                <td data-bind="ltext: 'applications.' + kind"></td>
                <td data-bind="text: address + ', ' + loc(['municipality', municipality])"></td>
                <td data-bind="ltext: 'operations.' + primaryOperation.name"></td>
                <td data-bind="text: applicant"></td>
                <td data-bind="dateTimeString: sent"></td>
                <td data-bind="dateTimeString: modified"></td>
                <td data-bind="ltext: state"></td>
                <td data-bind="fullName: authority"></td>
              </tr>
            </tbody>
          </table>
          <div><span data-bind="text: loc('applications.count', totalCount())"></span></div>
        </div>
      </div>
    </script>
  </section>
</body>
</html>
