<!DOCTYPE html>
<html>
<body>
  <section class="page container" id="create">
    <section id="create-part-1">

      <!-- Phase 1: -->

      <h1 data-bind="ltext: 'newRequest.topic'"></h1>
      <div class="create-application-search-box">
        <p data-bind="ltext: 'newRequest.locationInfo'"></p>
        <input data-bind="value: search, valueUpdate: 'afterkeydown', attr: {placeholder: loc('create.placeholder')}" id="create-search" type="text" class="form-input text address-search" autofocus="autofocus" />
        <button data-bind="click: searchNow" class="btn btn-primary" data-test-id="create-search-button">
          <span data-bind="ltext: 'search'"></span><span class="icon search left-align"></span>
        </button>
      </div>
      <div class="selected-location">
        <div class="map-select-info">
          <h3 data-bind="ltext: 'newRequest.chosenLocation'"></h3>
          <p data-bind="ltext: 'create.search-check-prompt'"></p>

          <div data-bind="visible: useManualEntry, ltext: 'integration.getAddressNotWorking'"></div>
          <div data-bind="visible: !municipalitySupported(), ltext: 'municipalityNotSupported'"></div>

          <div class="form-entry">
            <label class="form-label" data-bind ="ltext: 'newRequest.address'"></label>
            <input
              data-bind="value: addressString, valueUpdate: 'afterkeydown'"
              data-test-id="create-address"
              type="text"
              class="form-input text long"></input>
          </div>

          <div class="form-entry">
            <label class="form-label" data-bind="ltext: 'newRequest.municipality'"></label>
            <select
              data-bind="visible: useManualEntry,
                         options: municipalities.municipalities,
                         optionsText: function(m) { return loc(['municipality', m.id]); },
                         optionsValue: 'id',
                         value: municipalityCode,
                         optionsCaption: loc('choose')"
              data-test-id="create-municipality-select"
              class="form-select form-input combobox long">
            </select>
            <input
              data-bind="visible: !useManualEntry(), value: municipalityName"
              disabled="disabled"
              type="text"
              class="form-input text long">

            <label class="form-label" data-bind="ltext: 'newRequest.propertyId'"></label>
            <input
              data-bind="value: propertyId,
                         valueUpdate: 'afterkeydown',
                         enable: useManualEntry,
                         readonly: !currentUser.isAuthority()"
              data-test-id="create-property-id"
              type="text"
              class="form-input text long">
          </div>

          <button
              data-bind="enable: addressOk, click: goPhase2"
              class="btn btn-primary btn-nav-forward"
              data-test-id="create-continue"
              id="create-location-continue">
            <span data-bind="ltext: 'continue'"></span><span class="icon drill-right-white right-align"></span>
          </button>
        </div>
        <div id="create-map" class="map create-application-map" style="width: 75%; height: 580px;"></div>
      </div>
    </section>

    <!-- Phase 2: -->

    <section id="create-part-2">

      <h1 data-bind="ltext: 'newRequest.descTitle'"></h1>
      <span class="icon info-big right-align"></span>
      <p data-bind="ltext: 'newRequest.descInfo'" class="create-info-text" >
      </p>

      <div class="operation-tree tree-control"></div>

    </section>

    <!-- Phase 3: -->

    <section id="create-part-3" class="accordion">

      <h1 data-bind="ltext: 'createApplication.project-description-header'"></h1>
      <div>
        <p class="tab-info" data-bind="ltext: 'newRequest.create.desc'"></p>
        <form class="tree-intend">
          <h3 data-bind="ltext: 'newRequest.messageTitle'"></h3>
          <textarea
              class="form-input tree-width"
              data-bind="attr: {placeholder: loc('newRequest.inforequestMessage')}, value: message, valueUpdate: 'afterkeydown'"
              rows="3"
              data-test-id="create-inforequest-message">
          </textarea>
          <button
              data-bind="click: createInfoRequest, enable: message().length > 0"
              class="btn btn-primary"
              data-test-id="create-inforequest">
              <span data-bind="ltext: 'application.startConversation'"></span>
              <em data-bind="visible: pending" class="button-loader"></em>
          </button>
        </form>
        <br>
         <button data-bind="click: returnPhase2" class="btn" data-test-id="create-back" id="create-inforequest-back">
           <span class="icon inline-left drill-left-black"></span>
           <span data-bind="ltext: 'tree.back'">Takaisin</span>
        </button>
      </div>

    </section>

  </section>

  <section class="page" id="create-templates">

    <div class="tree-title" style="padding-left: 10px;">
      <span data-bind="visible: stack().length == 0, ltext: 'create.choose-op'">
      </span>
      <span data-bind="visible: stack().length > 0, foreach: stack">
        <span data-bind="visible: $index"> / </span>
        <span data-bind="text: loc(['operations.tree', op])"></span>
      </span>
    </div>

    <div class="tree-link">
      <span data-bind="text: loc(['operations.tree', op])"></span>
      <span class="icon drill-right-orange inline-right"></span>
    </div>

    <div class="tree-last">

      <div data-bind="text: loc('operations.selected') + ' ' + loc(['operations', operation()])"></div>
      <div data-bind="html: loc(['operations', operation(), 'desc'])"></div>

      <div class="organization-links" data-bind="visible: organizationLinks() && organizationLinks().length">
        <div data-bind="ltext: 'organization.links'"></div>
        <ul data-bind="foreach: organizationLinks">
          <li>
            <a data-bind="text: name.fi, attr: {href: url}" href="#" target="_blank"></a>
          </li>
        </ul>
      </div>

      <div class="organization-attachments" data-bind="visible: attachmentsForOp() && attachmentsForOp().length">
        <div data-bind="ltext: 'organization.attachments'"></div>
        <ul class="attachments-list" data-bind="foreach: attachmentsForOp">
          <li data-bind="text: loc(['attachmentType', group, id])" class="mandatory-attachments"></li>
        </ul>
      </div>

      <div class="create-buttons">
        <button data-bind="click: goPhase3, disable: processing"  data-test-id="create-proceed-to-inforequest" class="btn btn-primary">
          <span data-bind="ltext: 'newRequest.newInforequest'"></span><span class="icon add left-align"></span>
        </button>
        <button data-bind="click: createApplication, disable: processing" data-test-id="create-application" class="btn btn-primary">
          <em data-bind="visible: pending" class="button-loader"></em>
          <span data-bind="ltext: 'newRequest.newApplication'"></span><span class="icon add left-align"></span>
        </button>
      </div>
    </div>

  </section>

</body>
</html>
