<!DOCTYPE html>
<html>
<body>
  <section class="page container" id="create">

    <div class="breadcrumb">
      <a href="#!/applications" data-bind="ltext: 'request.requests'"></a>
      /
      <span data-bind="ltext: 'request.new'"></span>
    </div>

    <h1 data-bind="ltext: 'newRequest.topic'"></h1>
    <section id="create-part-1" class="accordion">
      <h2 data-bind="ltext: 'newRequest.title'" onclick="accordion.click(this);">
        <span class="font-icon icon-expanded"></span>
      </h2>
      <div class="accordion_content expanded">
        <p data-bind="ltext: 'newRequest.locationInfo'"></p>
        <div class="create-application-container">
          <div class="map-select-info">
            <h3 data-bind="ltext: 'newRequest.chosenLocation'">Valittu sijainti:</h3>
            <div class="form-entry">
              <label class="form-label" data-bind="ltext: 'newRequest.municipality'"></label>
              <select
                data-bind="options: municipalities,
                           optionsText: getMunicipalityName,
                           optionsValue: 'municipalityCode',
                           value: municipalityCode,
                           optionsCaption: loc('choose')"
                data-test-id="create-municipality-select"
                class="form-select form-input combobox long">
              </select>
            </div>
            <div class="form-entry">
              <label class="form-label" data-bind="ltext: 'newRequest.propertyId'"></label>
              <input
                data-bind="value: propertyId, valueUpdate: 'afterkeydown'"
                data-test-id="create-property-id"
                type="text"
                class="form-input text long"></input>
            </div>
            <div class="form-entry">
              <label class="form-label" data-bind ="ltext: 'newRequest.address'"></label>
              <input
                data-bind="value: address, valueUpdate: 'afterkeydown'"
                data-test-id="create-address"
                type="text"
                class="form-input text long"></input>
            </div>
            <button
                data-bind="enable: valuesOk, click: goPhase2, ltext: 'continue'"
                class="btn btn-primary"
                data-test-id="create-continue"
                id="create-location-continue">
            </button>
          </div>
          <div id="create-map" class="map map-large create-application-map" style="width: 500px; height: 600px;">
            <div class="create-application-search-box-container">
              <div class="create-application-search-box">
                <input data-bind="value: search, valueUpdate: 'afterkeydown'" id="create-search" type="text" class="form-input text address-search"/>
                <button data-bind="click: searchNow, ltext: 'search'" class="btn btn-primary map-search-button"></button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Phase 2: -->

    <div id="create-part-2"class="accordion">

      <h2 onclick="accordion.click(this);" data-bind="ltext: 'newRequest.descTitle'">
        <span class="font-icon icon-expanded"></span>
      </h2>

      <div class="accordion_content expanded">
        <p data-bind="ltext: 'newRequest.descInfo'"></p>

        <div class="tree" data-bind="visible: operations">
          <div class="tree-title">&nbsp;<span class="tree-breadcrumbs"></span></div>
          <div class="tree-content">
          </div>
        </div>
        <div class="tree" data-bind="visible: !operations()">
          <img src="/img/ajax-loader.gif" alt="loading"/>
        </div>

        <div style="margin-top: 10px;">
          <button data-bind="click: goPhase3, enable: operation, ltext: 'newRequest.newInforequest'"  data-test-id="create-proceed-to-inforequest" class="btn btn-primary"></button>
          <button data-bind="click: createApplication, enable: operation, ltext: 'newRequest.newApplication'" data-test-id="create-application" class="btn btn-primary"></button>
        </div>
      </div>

    </div>

    <!-- Phase 3: -->

    <div id="create-part-3" class="accordion">

      <h2 onclick="accordion.click(this);" data-bind="ltext: 'createApplication.project-description-header'">
        <span  class="font-icon icon-expanded"></span>
      </h2>

      <div class="accordion_content expanded">
        <form class="tree-intend">
          <h3 data-bind="ltext: 'newRequest.messageTitle'"></h3>
          <textarea
              class="form-input tree-width"
              data-bind="attr: {placeholder: loc('newRequest.inforequestMessage')}, value: message, valueUpdate: 'afterkeydown'"
              rows="3"
              data-test-id="create-inforequest-message">
          </textarea>
          <button
              data-bind="ltext: 'application.startConversation', click: createInfoRequest, enable: message().length > 0"
              class="btn btn-primary"
              data-test-id="create-inforequest">
          </button>
        </form>
      </div>

    </div>

  </section>
</body>
</html>
